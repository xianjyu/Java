# Java Lesson

## Java字符串

## 2019-12-10

## 公告
> 今天我们学习 Java 开发中最常用的字符串类型
- 字符串
    - 字符串的定义、创建
    - 字符串常用操作：长度、子串、拼接等
    - String / StringBuffer /StringBuilder
    - JVM 对字符串的优化
    - 应用练习：使用 TDD 编写
    - 常见面试问题
- 课后练习

## 1. 字符串

### 1.1. 字符串定义
- Java字符串就是Unicode字符序列，由`char`序列组成。Java 没有内置的字符串类型，而是在标准 `Java` 类库中提供了一个预定义类 `String` ，每个用双引号括起来的字符串都是 `String` 类的一个实例，可以通过直接赋值或者 `new` 操作符来创建字符串
```
String str1 = "";
String str2 = "Hello, This is a string!"
String str3 = new String("Create string with new");
```
`String` 类没有提供用于修改字符串的方法，所以我们将 `String` 类对象称为不可变字符串，它被声明为 `final class`，所有的属性也被定义为 `final` 的。但是我们可以修改字符串变量，让它指向另外一个字符串

为了提高内存利用率，`JVM` 有一个字符串常量池，每次使用双引号定义字符串，JVM 会先到该 `常量池` 中来检测是否已经存在，存在则直接该对象的引用；否则在常量池中创建一个新增并返回该值的引用

使用 `new` 创建字符串（`new String("字符串");`）时，会直接在堆中创建该字符串并返回其引用。

从 Java 6 开始，String 类提供了 `intern()` 方法，调用该方法时，`JVM` 去字符串常量池检测是否已存在该字符串，如果已经存在则直接返回引用；如果不存在则在常量池中添加并返回其引用

Java 6 中，字符串常量池存在 PermGen 里，也就是(“永久代”)，而这个空间是有限的，基本不会被 FullGC 之外的垃圾收集机制扫描。如果使用不当，经常会发生 OOM(宕机)。在后续版本中，将字符串常量池放在了堆中，而且默认缓存大小也在不断扩大。在 Java 8 中永久代 PermGen 也被元数据区 MetaSpace 替代

String字符串内存使用示意图

![String字符串内存使用](./images/String字符串内存使用.png)

下面通过一些示例来验证一下：
```
String str1 = "hello";
String str2 = "hello";
String str3 = "hello" + "world";
String str4 = str2 + "world";
String str5 = new String("hello");
String str6 = new String("hello");
String str7 = str6.intern();
String str8 = new String("hello").intern();

System.out.println("str1 = str2, " + (str1 == str2));
System.out.println("str3 = str4, " + (str3 == str4));
System.out.println("str1 = str5, " + (str1 == str5));
System.out.println("str5 = str6, " + (str5 == str6));
System.out.println("str1 = str7, " + (str1 == str7));
System.out.println("str1 = str8, " + (str1 == str8));

String str9 = "hello";
str9 += "world";
System.out.println("str3 = str9, " + (str3 == str9));
```
### 1.2. 字符串操作

1.长度

`int length()` 返回采⽤ UTF-16 编码表示的给定字符串所需要的代码单元数量。也即是 String 类内部 char 数组的⻓度。（char 数据类型是⼀个采⽤ UTF-16 编码表示 Unicode 代码点的代码单元）
```
String str = "HelloWorld";
System.out.println(str + "字符串长度为：" + str.length());
```


`int codePointCount(int beginIndex, int endIndex)` 表示字符串的实际⻓度，即代码点数

经过研究发现：对于普通字符串，这两种方法得到的值是一样的，但对于UniCode编码来说，还是有一点区别。

实际情况是 `length()` 方法返回的是使用的是UTF-16编码的字符代码单元数量，不一定是实际上我们认为的字符个数。同理 `codePointCount()` 方法返回的是代码点个数，是实际上的字符个数

```
String str = "HelloWorld";
System.out.println(str + "字符串长度为：" + str.length());
System.out.println(str + "字符串长度为：" + str.codePointCount(0, str.length()));
```

2.子串

`String` 类的 `substring` 方法可以从一个较大的字符串提取出一个子串

- String substring(int beginIndex);
- String substring(int beginIndex, int endIndex);
 
```
String str3 = "miss you";
System.out.println(str3.substring(5));  // you
System.out.println(str3.substring(3,6));    // s y
```

3.拼接

与绝大多数的程序设计语言一样，java语言允许使用 `+` 号或者 `+=` 号连接(拼接)字符串
```
String str4 = "big" + "data";
System.out.println(str4);
String str5 = "java";
str5 += str4;
System.out.println(str5);
```

4.格式化

为了让字符串拼接更简洁直观，我们可以使⽤字符串格式化⽅法 String.format 

```
System.out.printf("hello, %s %n", "world");
System.out.printf("⼤写a：%c %n", 'A');
System.out.printf("100 > 50：%b %n", 100 > 50);
System.out.printf("100除以2：%d %n", 100 / 2);
System.out.printf("100的16进制数是：%x %n", 100);
System.out.printf("100的8进制数是：%o %n", 100);
System.out.printf("100元打8.5折扣是：%f 元%n", 100 * 0.85);
System.out.printf("上述价格的16进制数是：%a %n", 50 * 0.85);
System.out.printf("上⾯的折扣是%d%% %n", 85); // %转义
```

5.判断相等
- `equals` 判断是否相等
- `equalsIgnorceCase` 不区分大小写判断是否相等

注：一定不能使用 `==` 运算符检测两个值是否相等！这个运算符只能够确定两个字符串是否放置在同一个位置上。当然，如果字符串放置在同一个位置上，它们必然相等，但是完全有可能将内容相同的多个字符串拷贝放置在士的位置上，例如：
```
String greeting = "hello";
System.out.println(greeting == "hello");    // true
System.out.println(greeting.substring(1,3) == "hel");   //false

```
```
String str7 = "Hello";
String str8 = "hello";
System.out.println("str7 = str8 为：" + str7.equals(str8));
System.out.println("str7 = str8 为：" + str7.equalsIgnoreCase(str8));
```

6.前后缀、包含判断
- `stratsWith()` 前缀判断
- `endsWith()` 后缀判断
```
String str9 = "JavaWeb";
System.out.println(str9 + "是否以J开头：" + str9.startsWith("J"));
System.out.println(str9 + "是否以b结束：" + str9.endsWith("b"));
System.out.println(str9 + "是否包含aWe：" + str9.contains("aWe"));
```

7.查找
- `indexOf` 从前边查找
- `lastIndexOf` 从后边开始找
```

```
    